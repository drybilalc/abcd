<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AR Poster Viewer</title>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js"></script>
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#000; overflow:hidden; font-family:'Segoe UI',sans-serif; }
  a-scene { width:100vw; height:100vh; display:block; }

  /* Gizli video elementleri */
  #hidden-media { position:fixed; top:-9999px; left:-9999px; opacity:0; pointer-events:none; }

  /* Splash */
  #splash {
    position:fixed; inset:0; z-index:9999;
    background:linear-gradient(160deg,#08192f,#0a3d3a);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center; gap:18px;
    transition:opacity .6s;
  }
  #splash.out { opacity:0; pointer-events:none; }
  .sp-logo { font-size:2.4rem; font-weight:900; color:#e8b84b; letter-spacing:-1px; }
  .sp-logo span { color:#22a99a; }
  .sp-sub { font-size:.88rem; color:#8899bb; text-align:center; padding:0 32px; line-height:1.6; }
  .sp-spinner {
    width:50px; height:50px;
    border:3px solid rgba(201,151,58,.2); border-top-color:#c9973a;
    border-radius:50%; animation:spin 1s linear infinite;
  }
  @keyframes spin { to { transform:rotate(360deg); } }
  .sp-hint { font-size:.72rem; color:#334; text-align:center; padding:0 30px; }

  /* Top bar */
  #topbar {
    position:fixed; top:0; left:0; right:0; z-index:200;
    background:rgba(8,25,47,.85); backdrop-filter:blur(10px);
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 16px; border-bottom:1px solid rgba(201,151,58,.3);
  }
  .tb-title { font-size:.85rem; font-weight:700; color:#e8b84b; }
  .tb-sub   { font-size:.65rem; color:#6688aa; margin-top:1px; }
  .tb-badge {
    background:rgba(26,127,116,.25); border:1px solid #22a99a;
    color:#22a99a; font-size:.7rem; font-weight:600;
    padding:4px 10px; border-radius:20px;
    display:flex; align-items:center; gap:5px;
  }
  .dot { width:6px; height:6px; background:#22a99a; border-radius:50%; animation:blink 1.4s ease infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.15} }

  /* Banner */
  #banner {
    position:fixed; top:62px; left:50%; transform:translateX(-50%);
    z-index:200; white-space:nowrap;
    background:linear-gradient(135deg,#1a7f74,#c9973a);
    color:#fff; font-size:.82rem; font-weight:700;
    padding:7px 20px; border-radius:20px;
    box-shadow:0 4px 20px rgba(0,0,0,.4);
    opacity:0; transition:opacity .4s; pointer-events:none;
  }
  #banner.show { opacity:1; }

  /* Instructions */
  #instr {
    position:fixed; bottom:0; left:0; right:0; z-index:200;
    background:linear-gradient(transparent, rgba(8,25,47,.97) 30%);
    padding:50px 20px 24px; transition:opacity .4s;
  }
  #instr.hide { opacity:0; pointer-events:none; }
  .inst-title { font-size:.8rem; font-weight:700; color:#e8b84b; margin-bottom:8px; }
  .inst-row { display:flex; align-items:center; gap:10px; margin-bottom:7px; font-size:.8rem; color:#99bbcc; }
  .inst-row .n {
    background:#c9973a; color:#08192f; width:22px; height:22px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    font-size:.75rem; font-weight:700; flex-shrink:0;
  }
  .pills { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
  .pill {
    display:flex; align-items:center; gap:6px;
    background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12);
    padding:5px 10px; border-radius:8px; font-size:.75rem; color:#ccd;
  }
  .pd { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
</style>
</head>
<body>

<!-- Gizli video elementleri ‚Äî canvas texture i√ßin -->
<div id="hidden-media">
  <video id="vid1" src="./video1.mp4" playsinline webkit-playsinline muted loop crossorigin="anonymous" width="640" height="360"></video>
  <video id="vid2" src="./video2.mp4" playsinline webkit-playsinline muted loop crossorigin="anonymous" width="640" height="360"></video>
  <canvas id="canvas1" width="640" height="360"></canvas>
  <canvas id="canvas2" width="640" height="360"></canvas>
</div>

<!-- Splash -->
<div id="splash">
  <div class="sp-logo">AR POSTER <span>2026</span></div>
  <div class="sp-spinner"></div>
  <div class="sp-sub">AR engine y√ºkleniyor‚Ä¶<br>Posterdeki fotoƒüraflara kamerayƒ± tut</div>
  <div class="sp-hint">‚ö†Ô∏è Kamera izni gerekli &nbsp;¬∑&nbsp; ƒ∞nternet baƒülantƒ±sƒ± ≈üart</div>
</div>

<!-- Top bar -->
<div id="topbar">
  <div>
    <div class="tb-title">AR Poster - dev. by Yusuf Bilal √áETINKAYA</div>
    <div class="tb-sub">Zero-Shot Visual Assessment of Ovine Colostrum Quality by General-Purpose Multimodal AI: Agreement with Digital Brix Refractometry
</div>
  </div>
  <div class="tb-badge"><div class="dot"></div>AR Live</div>
</div>


<!-- A-Frame sahne -->
<a-scene
  mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; uiLoading: no; uiError: no; uiScanning: no; filterMinCF: 0.001; filterBeta: 1000; warmupTolerance: 5; missTolerance: 5"
  color-space="sRGB"
  renderer="colorManagement: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
  embedded
>
  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <!-- Target 0: G√∂rsel1 ‚Äî Saƒüƒ±m fotoƒürafƒ± -->
  <a-entity mindar-image-target="targetIndex: 0" id="t0">
    <a-plane id="plane0"
      width="1" height="0.5625"
      position="0 0 0.001"
      visible="false">
    </a-plane>
    <a-plane id="frame0"
      width="1.05" height="0.61"
      position="0 0 0"
      material="color:#c9973a; opacity:0.3; side:double"
      visible="false">
    </a-plane>
  </a-entity>

  <!-- Target 1: G√∂rsel2 ‚Äî Kuzu fotoƒürafƒ± -->
  <a-entity mindar-image-target="targetIndex: 1" id="t1">
    <a-plane id="plane1"
      width="1" height="0.5625"
      position="0 0 0.001"
      visible="false">
    </a-plane>
    <a-plane id="frame1"
      width="1.05" height="0.61"
      position="0 0 0"
      material="color:#22a99a; opacity:0.3; side:double"
      visible="false">
    </a-plane>
  </a-entity>

</a-scene>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const splash  = document.getElementById('splash');
  const instr   = document.getElementById('instr');
  const banner  = document.getElementById('banner');
  const scene   = document.querySelector('a-scene');

  const vid1    = document.getElementById('vid1');
  const vid2    = document.getElementById('vid2');
  const canvas1 = document.getElementById('canvas1');
  const canvas2 = document.getElementById('canvas2');
  const ctx1    = canvas1.getContext('2d');
  const ctx2    = canvas2.getContext('2d');

  const t0 = document.getElementById('t0');
  const t1 = document.getElementById('t1');

  let raf1 = null, raf2 = null, bannerTimer = null;

  // Canvas texture'ƒ± A-Frame plane'e baƒüla
  function bindCanvasToPlane(canvas, planeEl) {
    const mesh = planeEl.getObject3D('mesh');
    if (!mesh) return;
    const texture = new THREE.CanvasTexture(canvas);
    texture.flipY = false;
    mesh.material.map = texture;
    mesh.material.shader = 'flat';
    mesh.material.needsUpdate = true;
    return texture;
  }

  // Video frame'lerini canvas'a √ßiz
  function startDraw(video, ctx, canvas, texture, rafSetter) {
    function loop() {
      if (!video.paused && !video.ended) {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        if (texture) texture.needsUpdate = true;
      }
      rafSetter(requestAnimationFrame(loop));
    }
    rafSetter(requestAnimationFrame(loop));
  }

  function showBanner(msg) {
    banner.textContent = msg;
    banner.classList.add('show');
    clearTimeout(bannerTimer);
    bannerTimer = setTimeout(() => banner.classList.remove('show'), 3500);
  }

  let tex1, tex2;

  scene.addEventListener('arReady', () => {
    splash.classList.add('out');

    // Texture baƒülantƒ±larƒ±nƒ± kur (scene loaded olduktan sonra)
    tex1 = bindCanvasToPlane(canvas1, document.getElementById('plane0'));
    tex2 = bindCanvasToPlane(canvas2, document.getElementById('plane1'));
  });

  scene.addEventListener('arError', () => {
    splash.querySelector('.sp-sub').textContent = '‚ö†Ô∏è AR ba≈ülatƒ±lamadƒ±. Kamera iznini kontrol et.';
    splash.querySelector('.sp-spinner').style.display = 'none';
  });

  setTimeout(() => splash.classList.add('out'), 10000);

  // ‚îÄ‚îÄ TARGET 0: Saƒüƒ±m fotoƒürafƒ± ‚îÄ‚îÄ
  t0.addEventListener('targetFound', () => {
    if (!tex1) tex1 = bindCanvasToPlane(canvas1, document.getElementById('plane0'));
    document.getElementById('plane0').setAttribute('visible', true);
    document.getElementById('frame0').setAttribute('visible', true);
    vid1.play().catch(() => {});
    startDraw(vid1, ctx1, canvas1, tex1, v => raf1 = v);
    instr.classList.add('hide');
    showBanner('üìπ Kolostrum Toplama');
  });
  t0.addEventListener('targetLost', () => {
    document.getElementById('plane0').setAttribute('visible', false);
    document.getElementById('frame0').setAttribute('visible', false);
    vid1.pause();
    cancelAnimationFrame(raf1);
    instr.classList.remove('hide');
  });

  // ‚îÄ‚îÄ TARGET 1: Kuzu fotoƒürafƒ± ‚îÄ‚îÄ
  t1.addEventListener('targetFound', () => {
    if (!tex2) tex2 = bindCanvasToPlane(canvas2, document.getElementById('plane1'));
    document.getElementById('plane1').setAttribute('visible', true);
    document.getElementById('frame1').setAttribute('visible', true);
    vid2.play().catch(() => {});
    startDraw(vid2, ctx2, canvas2, tex2, v => raf2 = v);
    instr.classList.add('hide');
    showBanner('üêë Neonatal Besleme ');
  });
  t1.addEventListener('targetLost', () => {
    document.getElementById('plane1').setAttribute('visible', false);
    document.getElementById('frame1').setAttribute('visible', false);
    vid2.pause();
    cancelAnimationFrame(raf2);
    instr.classList.remove('hide');
  });
});
</script>

</body>
</html>
